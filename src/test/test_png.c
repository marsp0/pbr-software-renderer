#include "test_png.h"

#include <stdio.h>

#include "test_utils.h"
#include "../parsers/png.h"

#include <string.h>

void test_png(void)
{
    unsigned char buffer[] = {
        0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a,     // png magic number
        
        0x00, 0x00, 0x00, 0x0d, 0x49, 0x48, 0x44, 0x52,     // header size + header type
        0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x05,     // width and height
        0x08, 0x02, 0x00, 0x00, 0x00,                       // bits per pixel, color type, 
                                                            // compression, filter, interlace
        0xe0, 0xd1, 0xaa, 0xcb,                             // header crc
        
        0x00, 0x00, 0x00, 0x1d, 0x49, 0x44, 0x41, 0x54,     // data chunk size + type
        0x78, 0xda,                                         // zlib header
        0x1d, 0xc6, 0x49, 0x01, 0x00, 0x00, 0x10, 0x40,     // deflate stream
        0xc0, 0xac, 0xa3, 0x7f, 0x88, 0x3d, 0x3c, 0x20, 
        0x2a, 0x97, 0x9d, 0x37, 0x5e, 0x1d, 0x0c,
        0x00, 0x00, 0x00, 0x00,                             // zlib trailer (adler 32)
        0xfc, 0xca, 0x79, 0xd8,                             // data chunk crc

        0x00, 0x00, 0x00, 0x00, 0x49, 0x45, 0x4e, 0x44,     // end chunk size + type
        0xae, 0x42, 0x60, 0x82                              // end chunk crc
    };

    uint32_t buffer_size = 86;

    texture_t* tex = parse_png(buffer, buffer_size);
    // baa bbb 
    // baa bab 
    // aab aba 
    // aab aaa 
    // bbb baa
    ASSERT_STRING("baabbbbaababaababaaabaaabbbbaa", tex->data, 30);
}